# Руководство по работе с миграциями Alembic

## Проблема: "Target database is not up to date"

Эта ошибка возникает, когда таблицы в базе данных были созданы напрямую (через `init_data.py`), но Alembic не знает об их состоянии.

## Решение

У вас есть два варианта:

### Вариант 1: Применить существующие миграции (если таблицы еще не созданы)

Если база данных пустая или вы хотите пересоздать таблицы через миграции:

```powershell
# Применить все миграции
alembic upgrade head

# Затем заполнить данными
python -m bot.database.init_data
```

### Вариант 2: Пометить текущее состояние как примененное (если таблицы уже созданы)

Если таблицы уже созданы через `init_data.py` и вы хотите синхронизировать Alembic с текущим состоянием БД:

```powershell
# Пометить текущее состояние БД как последнюю примененную миграцию
alembic stamp head

# Теперь можно создавать новые миграции
alembic revision --autogenerate -m "Описание изменений"
```

### Вариант 3: Удалить таблицы и создать заново через миграции

Если вы хотите использовать только миграции (рекомендуется для продакшена):

1. Удалите все таблицы в БД через pgAdmin или SQL:
```sql
DROP TABLE IF EXISTS user_dictionary, statistics, answers, words, 
user_achievements, training_sessions, users, categories, achievements CASCADE;
```

2. Примените миграции:
```powershell
alembic upgrade head
```

3. Заполните данными:
```powershell
python -m bot.database.init_data
```

## Рекомендация

Для курсового проекта **Вариант 2** самый простой:
- Таблицы уже созданы через `init_data.py`
- Просто синхронизируйте Alembic с текущим состоянием
- В будущем можно создавать новые миграции для изменений схемы

## Проверка состояния миграций

```powershell
# Проверить текущую версию миграции в БД
alembic current

# Показать историю миграций
alembic history

# Показать, какие миграции нужно применить
alembic heads
```
